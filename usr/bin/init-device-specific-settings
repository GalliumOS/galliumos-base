#!/bin/bash

#Copy the correct touchpad file
DEVICE=`/usr/sbin/dmidecode | grep "Product Name" | head -1 | \
        cut -f 2 -d ":" | awk '{print tolower($0)}' | sed -e 's/^[ \t]*//'`
TOUCHPAD_CONFIGS="/usr/share/xf86-input-cmt/"
DEST_CONFIG="/usr/share/X11/xorg.conf.d/"
CONFIG=`ls $TOUCHPAD_CONFIGS*${DEVICE}*.conf`

if [ ! -f ${DEST_CONFIG}${CONFIG} ]
then
   if [ -f $CONFIG ]
   then
      cp $CONFIG $DEST_CONFIG
   fi
fi


#Disable the touchpad from waking up the system from sleep
TPAD=`cat /proc/acpi/wakeup | grep TPAD | grep enabled | tr -d '\n'`
if [ -n "$TPAD" ]
then
   echo "TPAD" > /proc/acpi/wakeup
fi

ETPA=`cat /proc/acpi/wakeup | grep ETPA | grep enabled | tr -d '\n'`
if [ -n "$ETPA" ]
then
   echo "ETPA" > /proc/acpi/wakeup
fi

#Lower the min frequency of the gpu
MIN_FREQ="/sys/class/drm/card0/gt_min_freq_mhz"
for i in 100 200 300
do
   echo $i > $MIN_FREQ > /dev/null 2>&1
   if [ $? == "0" ]
   then
      break
   fi
done


#Change permissions on backlight controls
chgrp plugdev /sys/class/backlight/intel_backlight/brightness
chmod 664 /sys/class/backlight/intel_backlight/brightness

#Tweak the bfq scheduler for /dev/sda
echo 200 > /sys/block/sda/queue/iosched/timeout_sync
